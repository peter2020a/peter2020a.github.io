(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{280:function(a,s,t){"use strict";t.r(s);var e=t(13),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker搭建hadoop-伪分布式与完全分布式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker搭建hadoop-伪分布式与完全分布式"}},[a._v("#")]),a._v(" Docker搭建Hadoop(伪分布式与完全分布式)")]),a._v(" "),s("h2",{attrs:{id:"一、环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、环境准备"}},[a._v("#")]),a._v(" 一、环境准备")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("阿里云轻量应用服务器（学生价很实惠的~），我的配置：1C、2G、40G（足够了）")])]),a._v(" "),s("li",[s("p",[a._v("CentOS7.3，内核4.4（可用uname -r 查看，自带的3.10.x可能会导致Docker运行不稳定）")])]),a._v(" "),s("li",[s("p",[a._v("Docker版本：19.03.5（安装参考官网即可）")])]),a._v(" "),s("li",[s("p",[a._v("JDK1.8：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('wget --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u111-b14/jdk-8u111-linux-x64.tar.gz\n')])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("Hadoop：http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.7.7/hadoop-2.7.7.ta​​r.gz （ps：source为源码包，binary为安装包）")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz\n")])])]),s("h2",{attrs:{id:"二、构建ssh-centos镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、构建ssh-centos镜像"}},[a._v("#")]),a._v(" 二、构建ssh-centos镜像")]),a._v(" "),s("h3",{attrs:{id:"_1、创建对应目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建对应目录"}},[a._v("#")]),a._v(" 1、创建对应目录")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mkdir centos-ssh\ncd centos-ssh\nvim Dockerfile    #这里docker build时缺省名为Dockerfile\n")])])]),s("h3",{attrs:{id:"_2、编写dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写dockerfile"}},[a._v("#")]),a._v(" 2、编写Dockerfile")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('FROM centos\n\n# 镜像的作者  \n MAINTAINER xiedong\n\n# 安装openssh-server和sudo软件包，并且将sshd的UsePAM参数设置成no  \nRUN yum install -y openssh-server sudo\nRUN sed -i \'s/UsePAM yes/UsePAM no/g\' /etc/ssh/sshd_config\n#安装openssh-clients\nRUN yum  install -y openssh-clients\n\n# 添加测试用户root，密码root，并且将此用户添加到sudoers里  \nRUN echo "root:root" | chpasswd\nRUN echo "root   ALL=(ALL)       ALL" >> /etc/sudoers\nRUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key\nRUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key\n# 启动sshd服务并且暴露22端口  \nRUN mkdir /var/run/sshd\nEXPOSE 22\nCMD ["/usr/sbin/sshd", "-D"]\n')])])]),s("h3",{attrs:{id:"_3、构建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、构建镜像"}},[a._v("#")]),a._v(" 3、构建镜像")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker build -t 'xd/centos-ssh' .    #注意别忘记末尾的点\n")])])]),s("h2",{attrs:{id:"三、构建jdk1-8镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、构建jdk1-8镜像"}},[a._v("#")]),a._v(" 三、构建jdk1.8镜像")]),a._v(" "),s("h3",{attrs:{id:"_1、创建目录并上传jdk至该目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建目录并上传jdk至该目录"}},[a._v("#")]),a._v(" 1、创建目录并上传JDK至该目录")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mkdir centos-ssh-root-jdk\ncd centos-ssh-root-jdk\n")])])]),s("h3",{attrs:{id:"_2、编辑dockerfile-docker-build-缺省名为dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、编辑dockerfile-docker-build-缺省名为dockerfile"}},[a._v("#")]),a._v(" 2、编辑Dockerfile（docker build 缺省名为Dockerfile）")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#基于上一个ssh镜像构建\nFROM xd/centos-ssh    \n#拷贝并解压jdk                                        \nADD jdk-8u231-linux-x64.tar.gz /usr/local/\nRUN mv /usr/local/jdk1.8.0_231 /usr/local/jdk1.8\nENV JAVA_HOME /usr/local/jdk1.8\nENV PATH $JAVA_HOME/bin:$PATH\n")])])]),s("h3",{attrs:{id:"_3、构建jdk1-8镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、构建jdk1-8镜像"}},[a._v("#")]),a._v(" 3、构建jdk1.8镜像")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker build -t 'xd/centos-jdk' .\n")])])]),s("h2",{attrs:{id:"四、构建hadoop镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、构建hadoop镜像"}},[a._v("#")]),a._v(" 四、构建hadoop镜像")]),a._v(" "),s("h3",{attrs:{id:"_1、创建目录并上传hadoop安装包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建目录并上传hadoop安装包"}},[a._v("#")]),a._v(" 1、创建目录并上传Hadoop安装包")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mkdir centos-ssh-root-jdk-hadoop\ncd centos-ssh-root-jdk-hadoop\n")])])]),s("h3",{attrs:{id:"_2、编写dockerfile-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写dockerfile-2"}},[a._v("#")]),a._v(" 2、编写Dockerfile")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("FROM xd/centos-jdk\nADD hadoop-2.7.7.tar.gz /usr/local\nRUN mv /usr/local/hadoop-2.7.7 /usr/local/hadoop\nENV HADOOP_HOME /usr/local/hadoop\nENV PATH $HADOOP_HOME/bin:$PATH\n")])])]),s("h3",{attrs:{id:"_3、构建镜像-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、构建镜像-2"}},[a._v("#")]),a._v(" 3、构建镜像")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker build -t 'xd/hadoop' .\n")])])]),s("h2",{attrs:{id:"五、启动容器并固定ip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、启动容器并固定ip"}},[a._v("#")]),a._v(" 五、启动容器并固定IP")]),a._v(" "),s("h3",{attrs:{id:"_1、集群规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、集群规划"}},[a._v("#")]),a._v(" 1、集群规划")]),a._v(" "),s("p",[a._v("主节点：hadoop0 ip:192.168.2.10")]),a._v(" "),s("p",[a._v("从节点1：hadoop1 ip:192.168.2.11")]),a._v(" "),s("p",[a._v("从节点2：hadoop2 ip:192.168.2.12")]),a._v(" "),s("p",[a._v("ps:这里Docker容器重启后IP会发生变化，所以需要给Docker设置固定IP，使用pipework给docker固定ip")]),a._v(" "),s("h3",{attrs:{id:"_2、启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、启动容器"}},[a._v("#")]),a._v(" 2、启动容器")]),a._v(" "),s("p",[a._v("分别为hadoop0、hadoop1、hadoop2")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run --name hadoop0 --hostname hadoop0 -d -P -p 50070:50070 -p 8088:8088 xd/hadoop    #hadoop0对外开放端口50070和8088\ndocker run --name hadoop1 --hostname hadoop1 -d -P xd/hadoop\ndocker run --name hadoop2 --hostname hadoop2 -d -P xd/hadoop\n")])])]),s("p",[a._v("docker ps查看刚刚启动的3个容器")]),a._v(" "),s("h3",{attrs:{id:"_3、固定ip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、固定ip"}},[a._v("#")]),a._v(" 3、固定IP")]),a._v(" "),s("p",[a._v("docker容器重启以后ip会发生变化，所以这里通过pipework给docker固定ip，pipework下载地址：https://github.com/jpetazzo/pipework")]),a._v(" "),s("ol",[s("li",[a._v("上传、解压并改名该压缩包")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("unzip pipework-master.zip \nmv pipework-master pipework\ncp -rp pipework/pipework /usr/local/bin/\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("安装birdge-utils")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("yum -y install bridge-utils\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("创建网络")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("brctl addbr br0\nip link set dev br0 up\nip addr add 192.168.2.1/24 dev br0\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("设置固定IP")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("pipework br0 hadoop0 192.168.2.10/24\npipework br0 hadoop1 192.168.2.11/24\npipework br0 hadoop2 192.168.2.12/24\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("验证\n分别ping这3个ip即可验证ip是否设定成功")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ping 192.168.2.10\nping 192.168.2.11\nping 192.168.2.12\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);